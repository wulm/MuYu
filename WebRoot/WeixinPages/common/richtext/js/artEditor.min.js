jQuery.fn.extend({_opt:{placeholader:"<p>请输入文章正文内容</p>",validHtml:[],limitSize:3,showServer:!1},artEditor:function(e){var t=this,o={"-webkit-user-select":"text","user-select":"text","overflow-y":"auto","text-break":"brak-all",outline:"none"};jQuery(this).css(o).attr("contenteditable",!0),t._opt=jQuery.extend(t._opt,e);try{jQuery(t._opt.imgTar).on("change",function(e){var o=e.target.files[0];if(Math.ceil(o.size/1024/1024)>t._opt.limitSize)return void console.error("文件太大");var a=new FileReader;a.readAsDataURL(o),a.onload=function(e){if(t._opt.showServer)return void t.upload(e.target.result);var o='<img src="'+e.target.result+'" style="width:90%;" />';t.insertImage(o)}}),t.placeholderHandler(),t.pasteHandler()}catch(a){console.log(a)}},upload:function(e){{var t=this;t._opt.uploadField}jQuery.ajax({url:t._opt.uploadUrl,type:"post",data:jQuery.extend(t._opt.data,{filed:e}),cache:!1}).then(function(e){var o=t._opt.uploadSuccess(e);if(o){var a='<img src="'+o+'" style="width:90%;" />';t.insertImage(a)}else t._opt.uploadError(e)})},insertImage:function(e){jQuery(this).focus();var t=window.getSelection?window.getSelection():document.selection,o=t.createRange?t.createRange():t.getRangeAt(0);if(window.getSelection){o.collapse(!1);for(var a=o.createContextualFragment(e),r=a.lastChild;r&&"br"==r.nodeName.toLowerCase()&&r.previousSibling&&"br"==r.previousSibling.nodeName.toLowerCase();){var i=r;r=r.previousSibling,a.removeChild(i)}o.insertNode(o.createContextualFragment("<br/>")),o.insertNode(a),r&&(o.setEndAfter(r),o.setStartAfter(r)),t.removeAllRanges(),t.addRange(o)}else o.pasteHTML(e),o.collapse(!1),o.select()},pasteHandler:function(){jQuery(this).on("paste",function(){})},placeholderHandler:function(){var e=this;jQuery(this).on("focus",function(){jQuery.trim(jQuery(this).html())===e._opt.placeholader&&jQuery(this).html("")}).on("blur",function(){jQuery(this).html()||jQuery(this).html(e._opt.placeholader)}),jQuery.trim(jQuery(this).html())||jQuery(this).html(e._opt.placeholader)},getValue:function(){return jQuery(this).html()},setValue:function(e){jQuery(this).html(e)}});